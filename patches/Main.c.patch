diff --git a/src/Main.c b/src/Main.c
index dff22b9..476cb01 100644
--- a/src/Main.c
+++ b/src/Main.c
@@ -14,6 +14,7 @@
 #include <ctype.h>
 #include <errno.h>
 #include <stdarg.h>
+#include <stdint.h>
 
 // ==================================================================
 // Global constants
@@ -116,11 +117,11 @@ static void output(
 		A->charge
 		);
 }
-static void search(const char *filename,Jess *J,double tRmsd,double tDistance,double max_total_threshold,int no_transform,int ignore_chain,int write_filename,int ignore_endmdl, float conservation_cutoff)
+static void search(const char *filename,Jess *J,double tRmsd,double tDistance,double max_total_threshold,int no_transform,int ignore_chain,int write_filename,int ignore_endmdl, float conservation_cutoff, bool fastScan)
 {
 	Molecule *M;
 	Superposition *sup;
-	Template *T;
+	Template *T, *Tprev;
 	Atom **A;
 	FILE *file;
 	JessQuery *Q;
@@ -145,11 +146,21 @@ static void search(const char *filename,Jess *J,double tRmsd,double tDistance,do
 		return;
 	}
 
-	Q=Jess_query(J,M,tDistance,max_total_threshold);
+	Q=Jess_query(J,M,tDistance,max_total_threshold,fastScan);
+	T=JessQuery_template(Q);
 
-	while(JessQuery_next(Q, ignore_chain) && killswitch<1000)
+	while(JessQuery_next(Q, ignore_chain))
 	{
+		Tprev=T;
 		T=JessQuery_template(Q);
+		// printf("current template: %s\n", T->name(T));
+
+		killswitch = (T!=Tprev) ? 0 : killswitch + 1;
+		if(killswitch == 1000)
+		{
+			JessQuery_nextTemplate(Q);
+			continue;
+		}
 
 		count=T->count(T);
 		sup = JessQuery_superposition(Q);
@@ -193,7 +204,8 @@ static void search(const char *filename,Jess *J,double tRmsd,double tDistance,do
 
 			printf("ENDMDL\n\n");
 		}
-		killswitch+=1;
+
+		Superposition_free(sup);
 	}
 
 	JessQuery_free(Q);
@@ -339,6 +351,7 @@ int main(int argc, char **argv)
 	int ignore_chain=0;
 	int write_filename=0;
 	int ignore_endmdl=0;
+	int fastScan=0;
 
 	if(argc<7 || argc>8) help();
 
@@ -354,6 +367,7 @@ int main(int argc, char **argv)
 			else if(*s=='i') ignore_chain=1;
 			else if(*s=='q') write_filename=1;
 			else if(*s=='e') ignore_endmdl=1;
+			else if(*s=='s') fastScan=1;
 			else help();
 		}
 	}
@@ -388,10 +402,11 @@ int main(int argc, char **argv)
 		if(strlen(s)==0) continue;
 
 		if(feedbackQ) fprintf(stderr,"%s\n",s);
-		search(buf,J,tRmsd,tDistance,max_total_threshold,no_transform,ignore_chain,write_filename,ignore_endmdl,conservation_cutoff);
+		search(buf,J,tRmsd,tDistance,max_total_threshold,no_transform,ignore_chain,write_filename,ignore_endmdl,conservation_cutoff,fastScan);
 	}
 
 	fclose(file);
+	Jess_free(J);
 
 	return 0;
 }
